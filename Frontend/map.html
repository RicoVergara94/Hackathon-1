<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="shortcut icon" type="images/png" href="images/" />

    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style.css" />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin=""
    />
    <script
      defer
      src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
      integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
      crossorigin=""
    ></script>

    <!-- <script defer src="other.js"></script> -->
    <script defer src="script.js"></script>
    <title>mapty // Map your workouts</title>
  </head>
  <body>
    <div class="section">
      <div class="sidebar">
        <img
          src="images/sync-removebg-preview (1).png"
          alt="Logo"
          class="logo"
        />
        <ul class="rides"></ul>
      </div>
      <div id="map"></div>
    </div>
    <form id="search-form">
      <input type="text" id="search-bar" placeholder="Search location..." />
      <button type="submit">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="search-btn"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"
          />
        </svg>
      </button>
    </form>
    <button class="add-ride-btn">
      <span>Add Ride</span>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="add-ride-icon"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15M12 9l3 3m0 0-3 3m3-3H2.25"
        />
      </svg>
    </button>
    <button class="my_location_btn">
      <span><img src="images/my_location.svg" class="my_location_icon" /></span>
    </button>
    <div class="overlay hidden"></div>
    <form id="add-ride-form" class="hidden">
      <button class="form-return-btn">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="return-icon"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M6 18 18 6M6 6l12 12"
          />
        </svg>
      </button>
      <h2 class="addride-form-title">ADD RIDE</h2>
      <div>
        <img src="images/marker.svg" class="marker" />
        <input
          type="text"
          id="startingPoint"
          class="add-ride-form-inputfield"
          placeholder="From"
        />
        <img src="images/road.svg" alt="road icon" class="road-icon" />
        <img src="images/marker.svg" class="marker" />
        <input
          type="text"
          id="destination"
          class="add-ride-form-inputfield"
          placeholder="To"
        />
      </div>
      <input
        type="datetime-local"
        class="add-ride-form-inputfield"
        id="departureTime"
        name="departureTime"
        placeholder="Departure Time"
      />
      <input
        type="number"
        id="availableSeats"
        class="add-ride-form-inputfield"
        placeholder="Seats Avaiable"
      />
      <input
        type="number"
        id="payment"
        class="add-ride-form-inputfield"
        placeholder="$ 0"
      />
      <button class="add-form-btn">ADD</button>
    </form>

    <script>
      document
        .getElementById('ride-form')
        .addEventListener('submit', async e => {
          e.preventDefault();

          const driverId = localStorage.getItem('userId');
          if (!driverId) {
            alert('User not logged in');
            return;
          }

          console.log('here bubba');

          const ride = {
            driver: driverId,
            startingPoint: document.getElementById('startingPoint').value,
            destination: document.getElementById('destination').value,
            departureTime: document.getElementById('departureTime').value,
            availableSeats: document.getElementById('availableSeats').value,
            payment: document.getElementById('payment').value,
          };

          const response = await fetch('http://localhost:3000/api/rides', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(ride),
          });

          const data = await response.json();
          if (response.ok) {
            console.log('Ride posted successfully:', data);
          } else {
            console.error('Failed to post ride:', data.message);
          }
        });
    </script>
  </body>
</html>
